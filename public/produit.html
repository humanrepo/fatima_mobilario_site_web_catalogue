<!DOCTYPE html>
<html lang="fr">
<head>
    <!-- Métadonnées de base pour le SEO et la compatibilité -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <!-- Titre dynamique de la page (sera mis à jour via JavaScript) -->
    <title id="page-title">Produit - Fatima Mobiliário | Meubles Premium</title>
    
    <!-- Description dynamique pour les moteurs de recherche -->
    <meta name="description" id="page-description" content="Découvrez ce meuble premium de Fatima Mobiliário. Qualité exceptionnelle et design moderne.">
    
    <!-- Mots-clés pour le SEO -->
    <meta name="keywords" content="meuble, premium, design, qualité, Fatima Mobiliário, détails, prix">
    
    <!-- Open Graph dynamique pour les réseaux sociaux -->
    <meta property="og:title" id="og-title" content="Produit - Fatima Mobiliário">
    <meta property="og:description" id="og-description" content="Découvrez ce meuble premium de qualité exceptionnelle.">
    <meta property="og:image" id="og-image" content="/assets/images/default-product.jpg">
    <meta property="og:url" id="og-url" content="https://fatimamobiliario.com/produit.html">
    <meta property="og:type" content="product">
    
    <!-- Favicon et icônes -->
    <link rel="icon" type="image/x-icon" href="/assets/icons/favicon.ico">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/icons/apple-touch-icon.png">
    
    <!-- Couleur du thème -->
    <meta name="theme-color" content="#FFD800">
    
    <!-- Styles CSS -->
    <link rel="stylesheet" href="/assets/css/style.css">
    
    <!-- Préchargement des polices -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- JSON-LD pour le SEO structuré (sera mis à jour dynamiquement) -->
    <script type="application/ld+json" id="product-schema">
    {
        "@context": "https://schema.org",
        "@type": "Product",
        "name": "Produit Fatima Mobiliário",
        "description": "Meuble premium de qualité exceptionnelle",
        "brand": {
            "@type": "Brand",
            "name": "Fatima Mobiliário"
        },
        "offers": {
            "@type": "Offer",
            "availability": "https://schema.org/InStock",
            "price": "0",
            "priceCurrency": "EUR"
        }
    }
    </script>
</head>
<body>
    <!-- Header principal avec navigation -->
    <header class="header" role="banner">
        <div class="container">
            <div class="header__container">
                <!-- Logo de l'entreprise -->
                <a href="/" class="header__logo" aria-label="Retour à l'accueil Fatima Mobiliário">
                    <img src="/assets/images/logo.png" alt="Logo Fatima Mobiliário" width="40" height="40">
                    <span>Fatima Mobiliário</span>
                </a>
                
                <!-- Navigation principale -->
                <nav class="nav" role="navigation" aria-label="Navigation principale">
                    <ul class="nav">
                        <li class="nav__item">
                            <a href="/" class="nav__link">Accueil</a>
                        </li>
                        <li class="nav__item">
                            <a href="/catalogue.html" class="nav__link">Catalogue</a>
                        </li>
                        <li class="nav__item">
                            <a href="/a-propos.html" class="nav__link">À propos</a>
                        </li>
                        <li class="nav__item">
                            <a href="/contact.html" class="nav__link">Contact</a>
                        </li>
                    </ul>
                </nav>
                
                <!-- Bouton menu mobile -->
                <button class="nav-toggle" aria-label="Ouvrir le menu de navigation" aria-expanded="false">
                    <span class="nav-toggle__line"></span>
                    <span class="nav-toggle__line"></span>
                    <span class="nav-toggle__line"></span>
                </button>
            </div>
        </div>
    </header>

    <!-- Contenu principal -->
    <main role="main">
        <!-- Fil d'Ariane -->
        <section class="breadcrumb" aria-label="Fil d'Ariane">
            <div class="container">
                <nav class="breadcrumb__nav">
                    <ol class="breadcrumb__list">
                        <li class="breadcrumb__item">
                            <a href="/" class="breadcrumb__link">Accueil</a>
                        </li>
                        <li class="breadcrumb__item">
                            <a href="/catalogue.html" class="breadcrumb__link">Catalogue</a>
                        </li>
                        <li class="breadcrumb__item breadcrumb__item--current" aria-current="page">
                            <span id="breadcrumb-product-name">Chargement...</span>
                        </li>
                    </ol>
                </nav>
            </div>
        </section>

        <!-- Section du produit -->
        <section class="product-detail" aria-labelledby="product-title">
            <div class="container">
                <!-- Indicateur de chargement -->
                <div id="loading-indicator" class="loading-indicator">
                    <div class="loading-spinner"></div>
                    <span>Chargement du produit...</span>
                </div>
                
                <!-- Message d'erreur -->
                <div id="error-message" class="error-message" style="display: none;">
                    <div class="error-message__content">
                        <h2>Produit non trouvé</h2>
                        <p>Le produit que vous recherchez n'existe pas ou n'est plus disponible.</p>
                        <a href="/catalogue.html" class="btn btn--accent">Retour au catalogue</a>
                    </div>
                </div>
                
                <!-- Contenu du produit -->
                <div id="product-content" class="product-detail__content" style="display: none;">
                    <div class="row">
                        <!-- Carrousel d'images -->
                        <div class="col col-6">
                            <div class="product-gallery">
                                <!-- Carrousel principal -->
                                <div class="product-gallery__main">
                                    <div class="carousel" id="product-carousel">
                                        <div class="carousel__track" id="product-track">
                                            <!-- Les images seront ajoutées dynamiquement -->
                                        </div>
                                        
                                        <!-- Contrôles du carrousel -->
                                        <div class="carousel__controls" id="product-dots">
                                            <!-- Les points seront ajoutés dynamiquement -->
                                        </div>
                                        
                                        <!-- Flèches de navigation -->
                                        <button class="carousel__arrow carousel__arrow--prev" id="prev-image" aria-label="Image précédente">‹</button>
                                        <button class="carousel__arrow carousel__arrow--next" id="next-image" aria-label="Image suivante">›</button>
                                    </div>
                                </div>
                                
                                <!-- Miniatures -->
                                <div class="product-gallery__thumbnails" id="product-thumbnails">
                                    <!-- Les miniatures seront ajoutées dynamiquement -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- Informations du produit -->
                        <div class="col col-6">
                            <div class="product-info">
                                <!-- Badge de statut -->
                                <div class="product-info__status">
                                    <span id="product-status" class="product-card__status">Chargement...</span>
                                </div>
                                
                                <!-- Nom du produit -->
                                <h1 id="product-title" class="product-info__title">Chargement...</h1>
                                
                                <!-- Code du produit -->
                                <p class="product-info__code">
                                    <strong>Code produit :</strong> <span id="product-code">---</span>
                                </p>
                                
                                <!-- Prix -->
                                <div class="product-info__price">
                                    <span id="product-price" class="product-info__price-value">Prix sur demande</span>
                                </div>
                                
                                <!-- Description -->
                                <div class="product-info__description">
                                    <h2 class="product-info__section-title">Description</h2>
                                    <div id="product-description" class="product-info__description-content">
                                        Chargement de la description...
                                    </div>
                                </div>
                                
                                <!-- Informations supplémentaires -->
                                <div class="product-info__meta">
                                    <div class="product-info__meta-item">
                                        <strong>Date de publication :</strong>
                                        <span id="product-date">---</span>
                                    </div>
                                </div>
                                
                                <!-- Actions -->
                                <div class="product-info__actions">
                                    <a href="/contact.html" class="btn btn--accent btn--lg btn--full" id="quote-button">
                                        Demander un Devis
                                    </a>
                                    <button class="btn btn--outline btn--lg btn--full" id="share-button" type="button">
                                        Partager ce produit
                                    </button>
                                </div>
                                
                                <!-- Informations de contact -->
                                <div class="product-info__contact">
                                    <h3 class="product-info__contact-title">Besoin d'informations ?</h3>
                                    <p class="product-info__contact-text">
                                        Notre équipe est à votre disposition pour répondre à toutes vos questions.
                                    </p>
                                    <div class="product-info__contact-methods">
                                        <a href="tel:+351123456789" class="product-info__contact-link">
                                            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/>
                                            </svg>
                                            +351 123 456 789
                                        </a>
                                        <a href="mailto:contact@fatimamobiliario.com" class="product-info__contact-link">
                                            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
                                                <path d="M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.89 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
                                            </svg>
                                            contact@fatimamobiliario.com
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section des produits similaires -->
        <section class="related-products" aria-labelledby="related-title">
            <div class="container">
                <div class="section__header">
                    <h2 id="related-title">Produits Similaires</h2>
                    <p>Découvrez d'autres meubles qui pourraient vous intéresser</p>
                </div>
                
                <!-- Grille de produits similaires -->
                <div class="products-grid" id="related-products-container">
                    <!-- Les produits similaires seront chargés dynamiquement -->
                </div>
                
                <!-- Lien vers le catalogue complet -->
                <div class="text-center" style="margin-top: var(--spacing-2xl);">
                    <a href="/catalogue.html" class="btn btn--secondary btn--lg">
                        Voir Tout le Catalogue
                    </a>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer" role="contentinfo">
        <div class="container">
            <div class="footer__content">
                <div class="row">
                    <!-- Informations de l'entreprise -->
                    <div class="col col-4">
                        <div class="footer__section">
                            <h3 class="footer__title">Fatima Mobiliário</h3>
                            <p class="footer__text">
                                Votre partenaire de confiance pour des meubles de qualité premium. 
                                Design moderne, artisanat traditionnel.
                            </p>
                        </div>
                    </div>
                    
                    <!-- Navigation footer -->
                    <div class="col col-4">
                        <div class="footer__section">
                            <h3 class="footer__title">Navigation</h3>
                            <ul class="footer__links">
                                <li><a href="/" class="footer__link">Accueil</a></li>
                                <li><a href="/catalogue.html" class="footer__link">Catalogue</a></li>
                                <li><a href="/a-propos.html" class="footer__link">À propos</a></li>
                                <li><a href="/contact.html" class="footer__link">Contact</a></li>
                            </ul>
                        </div>
                    </div>
                    
                    <!-- Contact -->
                    <div class="col col-4">
                        <div class="footer__section">
                            <h3 class="footer__title">Contact</h3>
                            <div class="footer__contact">
                                <p class="footer__contact-item">
                                    <strong>Email:</strong> contact@fatimamobiliario.com
                                </p>
                                <p class="footer__contact-item">
                                    <strong>Téléphone:</strong> +351 123 456 789
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Copyright -->
            <div class="footer__bottom">
                <div class="row">
                    <div class="col">
                        <p class="footer__copyright">
                            © 2024 Fatima Mobiliário. Tous droits réservés.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Modal de partage -->
    <div class="modal" id="share-modal" style="display: none;" role="dialog" aria-labelledby="share-modal-title" aria-modal="true">
        <div class="modal__backdrop"></div>
        <div class="modal__content">
            <div class="modal__header">
                <h3 id="share-modal-title" class="modal__title">Partager ce produit</h3>
                <button class="modal__close" type="button" aria-label="Fermer">×</button>
            </div>
            <div class="modal__body">
                <p class="modal__text">Partagez ce produit avec vos proches :</p>
                <div class="share-buttons">
                    <a href="#" class="share-button share-button--facebook" id="share-facebook" target="_blank" rel="noopener">
                        <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                        </svg>
                        Facebook
                    </a>
                    <a href="#" class="share-button share-button--whatsapp" id="share-whatsapp" target="_blank" rel="noopener">
                        <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.885 3.488"/>
                        </svg>
                        WhatsApp
                    </a>
                    <button class="share-button share-button--copy" id="copy-link" type="button">
                        <svg width="24" height="24" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                        </svg>
                        Copier le lien
                    </button>
                </div>
                <div class="copy-feedback" id="copy-feedback" style="display: none;">
                    <span class="copy-feedback__text">Lien copié dans le presse-papiers !</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts JavaScript -->
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-storage-compat.js"></script>
    
    <!-- Scripts de l'application -->
    <script src="/assets/js/firebase.js"></script>
    <script src="/assets/js/app.js"></script>
    
    <!-- Script spécifique à la page produit -->
    <script>
        // Variables globales pour la page produit
        let currentProduct = null;
        let currentImageIndex = 0;
        let productImages = [];
        
        // Initialisation de la page produit
        document.addEventListener('DOMContentLoaded', function() {
            // Récupération de l'ID du produit depuis l'URL
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id');
            
            if (!productId) {
                showError();
                return;
            }
            
            // Chargement du produit
            loadProduct(productId);
            
            // Initialisation des événements
            initializeEvents();
        });
        
        /**
         * Charge un produit depuis Firebase
         * @param {string} productId - ID du produit à charger
         */
        async function loadProduct(productId) {
            try {
                showLoading();
                
                // Récupération du produit depuis Firestore
                const productDoc = await db.collection('products').doc(productId).get();
                
                if (!productDoc.exists) {
                    showError();
                    return;
                }
                
                const product = { id: productDoc.id, ...productDoc.data() };
                
                // Vérification du statut (seuls les produits publiés sont visibles)
                if (product.status !== 'published') {
                    showError();
                    return;
                }
                
                currentProduct = product;
                displayProduct(product);
                updateSEO(product);
                loadRelatedProducts(product);
                
                hideLoading();
                
            } catch (error) {
                console.error('Erreur lors du chargement du produit:', error);
                showError();
            }
        }
        
        /**
         * Affiche les informations du produit
         * @param {Object} product - Données du produit
         */
        function displayProduct(product) {
            // Mise à jour du titre et des informations de base
            document.getElementById('product-title').textContent = product.name;
            document.getElementById('breadcrumb-product-name').textContent = product.name;
            document.getElementById('product-code').textContent = product.code;
            document.getElementById('product-price').textContent = formatPrice(product.price);
            
            // Mise à jour du statut
            const statusElement = document.getElementById('product-status');
            statusElement.textContent = getStatusText(product.status);
            statusElement.className = `product-card__status product-card__status--${product.status}`;
            
            // Mise à jour de la description
            document.getElementById('product-description').innerHTML = product.description || 'Aucune description disponible.';
            
            // Mise à jour de la date de publication
            if (product.date_published) {
                const date = new Date(product.date_published.seconds * 1000);
                document.getElementById('product-date').textContent = formatDate(date);
            }
            
            // Chargement des images
            if (product.images && product.images.length > 0) {
                productImages = product.images.sort((a, b) => (a.order || 0) - (b.order || 0));
                displayProductImages(productImages);
            } else {
                // Image par défaut si aucune image
                productImages = [{ url: '/assets/images/default-product.jpg', alt: product.name }];
                displayProductImages(productImages);
            }
            
            // Affichage du contenu
            document.getElementById('product-content').style.display = 'block';
        }
        
        /**
         * Affiche les images du produit dans le carrousel
         * @param {Array} images - Tableau des images
         */
        function displayProductImages(images) {
            const track = document.getElementById('product-track');
            const dots = document.getElementById('product-dots');
            const thumbnails = document.getElementById('product-thumbnails');
            
            // Nettoyage des conteneurs
            track.innerHTML = '';
            dots.innerHTML = '';
            thumbnails.innerHTML = '';
            
            images.forEach((image, index) => {
                // Slide principal
                const slide = document.createElement('div');
                slide.className = 'carousel__slide';
                slide.innerHTML = `
                    <img src="${image.url}" alt="${image.alt || currentProduct.name}" class="carousel__image" loading="lazy">
                `;
                track.appendChild(slide);
                
                // Point indicateur
                const dot = document.createElement('button');
                dot.className = `carousel__dot ${index === 0 ? 'carousel__dot--active' : ''}`;
                dot.setAttribute('data-slide', index);
                dot.setAttribute('aria-label', `Afficher image ${index + 1}`);
                dot.addEventListener('click', () => goToSlide(index));
                dots.appendChild(dot);
                
                // Miniature
                const thumbnail = document.createElement('button');
                thumbnail.className = `product-gallery__thumbnail ${index === 0 ? 'product-gallery__thumbnail--active' : ''}`;
                thumbnail.innerHTML = `
                    <img src="${image.url}" alt="${image.alt || currentProduct.name}" loading="lazy">
                `;
                thumbnail.addEventListener('click', () => goToSlide(index));
                thumbnails.appendChild(thumbnail);
            });
            
            // Mise à jour de l'index actuel
            currentImageIndex = 0;
        }
        
        /**
         * Navigue vers une image spécifique du carrousel
         * @param {number} index - Index de l'image
         */
        function goToSlide(index) {
            if (index < 0 || index >= productImages.length) return;
            
            currentImageIndex = index;
            
            // Mise à jour de la position du carrousel
            const track = document.getElementById('product-track');
            track.style.transform = `translateX(-${index * 100}%)`;
            
            // Mise à jour des points indicateurs
            document.querySelectorAll('.carousel__dot').forEach((dot, i) => {
                dot.classList.toggle('carousel__dot--active', i === index);
            });
            
            // Mise à jour des miniatures
            document.querySelectorAll('.product-gallery__thumbnail').forEach((thumb, i) => {
                thumb.classList.toggle('product-gallery__thumbnail--active', i === index);
            });
        }
        
        /**
         * Met à jour les métadonnées SEO de la page
         * @param {Object} product - Données du produit
         */
        function updateSEO(product) {
            // Titre de la page
            const title = `${product.name} - Fatima Mobiliário | Meuble Premium`;
            document.title = title;
            document.getElementById('page-title').textContent = title;
            
            // Description
            const description = `Découvrez ${product.name} (${product.code}) - Meuble premium de Fatima Mobiliário. ${product.description ? product.description.substring(0, 150) + '...' : 'Qualité exceptionnelle et design moderne.'}`;
            document.getElementById('page-description').setAttribute('content', description);
            
            // Open Graph
            document.getElementById('og-title').setAttribute('content', title);
            document.getElementById('og-description').setAttribute('content', description);
            
            if (product.images && product.images.length > 0) {
                document.getElementById('og-image').setAttribute('content', product.images[0].url);
            }
            
            document.getElementById('og-url').setAttribute('content', window.location.href);
            
            // JSON-LD Schema
            const schema = {
                "@context": "https://schema.org",
                "@type": "Product",
                "name": product.name,
                "description": product.description || `Meuble premium ${product.name}`,
                "sku": product.code,
                "brand": {
                    "@type": "Brand",
                    "name": "Fatima Mobiliário"
                },
                "offers": {
                    "@type": "Offer",
                    "availability": product.status === 'published' ? "https://schema.org/InStock" : "https://schema.org/OutOfStock",
                    "price": product.price || "0",
                    "priceCurrency": "EUR"
                }
            };
            
            if (product.images && product.images.length > 0) {
                schema.image = product.images.map(img => img.url);
            }
            
            document.getElementById('product-schema').textContent = JSON.stringify(schema);
        }
        
        /**
         * Charge les produits similaires
         * @param {Object} product - Produit actuel
         */
        async function loadRelatedProducts(product) {
            try {
                // Requête pour récupérer 4 produits similaires (même catégorie ou aléatoires)
                let query = db.collection('products')
                    .where('status', '==', 'published')
                    .where('id', '!=', product.id)
                    .limit(4);
                
                const snapshot = await query.get();
                const relatedProducts = [];
                
                snapshot.forEach(doc => {
                    relatedProducts.push({ id: doc.id, ...doc.data() });
                });
                
                displayRelatedProducts(relatedProducts);
                
            } catch (error) {
                console.error('Erreur lors du chargement des produits similaires:', error);
            }
        }
        
        /**
         * Affiche les produits similaires
         * @param {Array} products - Liste des produits similaires
         */
        function displayRelatedProducts(products) {
            const container = document.getElementById('related-products-container');
            
            if (products.length === 0) {
                container.innerHTML = '<p class="text-center">Aucun produit similaire trouvé.</p>';
                return;
            }
            
            container.innerHTML = products.map(product => `
                <div class="product-card fade-in">
                    <div class="product-card__image-container">
                        <img src="${product.images && product.images.length > 0 ? product.images[0].url : '/assets/images/default-product.jpg'}" 
                             alt="${product.name}" class="product-card__image" loading="lazy">
                        <span class="product-card__status product-card__status--${product.status}">
                            ${getStatusText(product.status)}
                        </span>
                    </div>
                    <div class="product-card__content">
                        <h3 class="product-card__name">${product.name}</h3>
                        <p class="product-card__code">Code: ${product.code}</p>
                        <p class="product-card__price">${formatPrice(product.price)}</p>
                        <a href="/produit.html?id=${product.id}" class="btn btn--primary btn--sm">Voir Détails</a>
                    </div>
                </div>
            `).join('');
        }
        
        /**
         * Initialise les événements de la page
         */
        function initializeEvents() {
            // Navigation du carrousel
            document.getElementById('prev-image').addEventListener('click', () => {
                const prevIndex = currentImageIndex > 0 ? currentImageIndex - 1 : productImages.length - 1;
                goToSlide(prevIndex);
            });
            
            document.getElementById('next-image').addEventListener('click', () => {
                const nextIndex = currentImageIndex < productImages.length - 1 ? currentImageIndex + 1 : 0;
                goToSlide(nextIndex);
            });
            
            // Bouton de partage
            document.getElementById('share-button').addEventListener('click', openShareModal);
            
            // Modal de partage
            document.querySelector('.modal__close').addEventListener('click', closeShareModal);
            document.querySelector('.modal__backdrop').addEventListener('click', closeShareModal);
            
            // Boutons de partage
            document.getElementById('copy-link').addEventListener('click', copyLink);
            
            // Navigation au clavier pour le carrousel
            document.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowLeft') {
                    document.getElementById('prev-image').click();
                } else if (e.key === 'ArrowRight') {
                    document.getElementById('next-image').click();
                } else if (e.key === 'Escape') {
                    closeShareModal();
                }
            });
        }
        
        /**
         * Ouvre la modal de partage
         */
        function openShareModal() {
            if (!currentProduct) return;
            
            const modal = document.getElementById('share-modal');
            const currentUrl = window.location.href;
            const text = `Découvrez ${currentProduct.name} chez Fatima Mobiliário`;
            
            // Mise à jour des liens de partage
            document.getElementById('share-facebook').href = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(currentUrl)}`;
            document.getElementById('share-whatsapp').href = `https://wa.me/?text=${encodeURIComponent(text + ' ' + currentUrl)}`;
            
            modal.style.display = 'flex';
            document.body.style.overflow = 'hidden';
        }
        
        /**
         * Ferme la modal de partage
         */
        function closeShareModal() {
            document.getElementById('share-modal').style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        
        /**
         * Copie le lien du produit dans le presse-papiers
         */
        async function copyLink() {
            try {
                await navigator.clipboard.writeText(window.location.href);
                
                // Affichage du feedback
                const feedback = document.getElementById('copy-feedback');
                feedback.style.display = 'block';
                
                setTimeout(() => {
                    feedback.style.display = 'none';
                }, 2000);
                
            } catch (error) {
                console.error('Erreur lors de la copie:', error);
                // Fallback pour les navigateurs plus anciens
                const textArea = document.createElement('textarea');
                textArea.value = window.location.href;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
            }
        }
        
        /**
         * Affiche l'indicateur de chargement
         */
        function showLoading() {
            document.getElementById('loading-indicator').style.display = 'flex';
            document.getElementById('error-message').style.display = 'none';
            document.getElementById('product-content').style.display = 'none';
        }
        
        /**
         * Masque l'indicateur de chargement
         */
        function hideLoading() {
            document.getElementById('loading-indicator').style.display = 'none';
        }
        
        /**
         * Affiche le message d'erreur
         */
        function showError() {
            document.getElementById('loading-indicator').style.display = 'none';
            document.getElementById('error-message').style.display = 'block';
            document.getElementById('product-content').style.display = 'none';
        }
        
        /**
         * Formate le prix pour l'affichage
         * @param {number} price - Prix à formater
         * @returns {string} Prix formaté
         */
        function formatPrice(price) {
            if (!price) return 'Prix sur demande';
            return new Intl.NumberFormat('pt-PT', {
                style: 'currency',
                currency: 'EUR'
            }).format(price);
        }
        
        /**
         * Retourne le texte du statut en français
         * @param {string} status - Statut du produit
         * @returns {string} Texte du statut
         */
        function getStatusText(status) {
            const statusTexts = {
                'published': 'Disponible',
                'draft': 'Brouillon',
                'out_of_stock': 'Rupture de stock'
            };
            return statusTexts[status] || status;
        }
        
        /**
         * Formate une date pour l'affichage
         * @param {Date} date - Date à formater
         * @returns {string} Date formatée
         */
        function formatDate(date) {
            return new Intl.DateTimeFormat('fr-FR', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            }).format(date);
        }
    </script>
</body>
</html>